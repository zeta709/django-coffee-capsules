{% extends "coffee_capsules/base.html" %}
{% load staticfiles %}
{% load url from future %}
{% load humanize %}

{% block extra_style %}
<link rel="stylesheet" type="text/css" href="{% static 'coffee_capsules/detail.css' %}" />
{% endblock %}

{% block content %}
	{# FORM #}
	{% if purchaseitem_list %}
	<form action="{% url 'coffee_capsules:purchase_request' purchase.id %}" method="post">
		{% csrf_token %}
		{% for purchaseitem in purchaseitem_list %}
		<label for="text_{{ forloop.counter }}">{{ purchaseitem.capsule.name }}</label>
		<input type="text" name="capsule" id="text_{{ forloop.counter }}" />
		<br />
		{% endfor %}
		<input type="submit" value="Submit" />
	</form><br /><br />
	{% endif %}
	{# TABLES #}
	<table>
		<thead>
		<tr>
			<th>Capsule</th>
			<th>Price</th>
			<th>Qty. Accepted</th>
			<th>Qty. Grouped</th>
			<th>Qty. Queued</th>
		</tr>
		</thead>
		<tbody>{% if purchaseitem_list %}{% for purchaseitem in purchaseitem_list %}
		<tr>
			<td>{{ purchaseitem.capsule.name }}</td>
			<td>{{ purchaseitem.price|intcomma }}</td>
			<td>{{ purchaseitem.quantity_accepted|intcomma }}</td>
			<td>{{ purchaseitem.quantity_grouped|intcomma }}</td>
			<td>{{ purchaseitem.quantity_queued|intcomma }}</td>
		</tr>{% endfor %}{% else %}
		<tr>
			<td colspan="5">(Empty)</td>
		</tr>{% endif %}
		</tbody>
	</table>
	<br /><br />{% if request_list %}
	<table class="summary">
		<caption>
			Summary{%if agq %}<br />(A: accepted, G: grouped, Q: queued){% endif %}
		</caption>
		<colgroup>
			<col class="name" />{% if capsule_list %}{% for capsule in capsule_list %}
			<col class="quantity accepted" />
			<col class="quantity grouped" />
			<col class="quantity queued" />{% endfor %}{% endif %}
			<col class="sum accepted" />
			<col class="sum grouped" />
			<col class="sum queued" />
			<col class="price accepted" />
			<col class="price grouped" />
			<col class="price queued" />
		</colgroup>
		{# BEGIN thead #}{% if capsule_list %}
		<thead>
		<tr>
			<th{% if agq %} rowspan="2"{% endif %}>User</th>{% for capsule in capsule_list %}
			<th{% if agq %} colspan="3"{% endif %}>{{ capsule.1 }}</th>{% endfor %}
			<th{% if agq %} colspan="3"{% endif %}>Sum</th>
			<th{% if agq %} colspan="3"{% endif %}>Price</th>
		</tr>{% endif %}{% if agq %}
		<tr>{% for capsule in capsule_list %}
			<th>A</th>
			<th>G</th>
			<th>Q</th>{% endfor %}
			<th>A</th>
			<th>G</th>
			<th>Q</th>
			<th>A</th>
			<th>G</th>
			<th>Q</th>
		</tr>
		</thead>{% endif %}{# END thead #}
		{# BEGIN tfoot #}{% if total_row %}
		<tfoot>
		<tr>{% for i in total_row %}
			<td>{{ i|intcomma }}</td>{% endfor %}
		</tr>
		</tfoot>{% endif %}{# END tfoot #}
		{# BEGIN body #}{% if request_list %}
		<tbody>	{% for request in request_list %}
		<tr>{% for i in request %}
			<td>{{ i|intcomma }}</td>{% endfor %}
		</tr>{% endfor %}
		</tbody>{% endif %}{# END tbody #}
	</table>{% endif %}
{% endblock %}
