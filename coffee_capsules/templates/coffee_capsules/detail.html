{% extends "coffee_capsules/base.html" %}
{% load staticfiles %}
{% load url from future %}
{% load humanize %}

{% block extra_styles %}
<link rel="stylesheet" type="text/css" href="{% static 'coffee_capsules/detail.css' %}" />
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript">
function toggle(i) {
	var toggle_className;
	var mytab = document.getElementById('summary_each');
	var mygroup = mytab.getElementsByClassName('mycolgroup');
	switch (i) {
	case 1:
		break;
	case 2:
		toggle_className = 'hide_grouped';
		break;
	case 3:
		toggle_className = 'hide_queued';
		break;
	}
	var x;
	if (mytab.classList.contains(toggle_className)) {
		x = 1;
	} else {
		x = -1;
	}
	for (var i = 0; i < mygroup.length; ++i) {
		t = (parseInt(mygroup[i].getAttribute("colspan")) + x).toString();
		mygroup[i].setAttribute("colspan", t);
	}
	mytab.classList.toggle(toggle_className);
}
</script>
{% endblock %}

{% block content %}
	{# TABLES #}
	<table>
		<caption>
			Summary
		</caption>
		<thead>
		<tr>
			<th>Capsule</th>
			<th>Price</th>
			<th>Qty. Accepted</th>
			<th>Qty. Grouped</th>
			<th>Qty. Queued</th>
		</tr>
		</thead>
		<tbody>{% if purchaseitem_list %}{% for purchaseitem in purchaseitem_list %}
		<tr>
			<td>{{ purchaseitem.capsule.name }}</td>
			<td>{{ purchaseitem.price|intcomma }}</td>
			<td>{{ purchaseitem.quantity_accepted|intcomma }}</td>
			<td>{{ purchaseitem.quantity_grouped|intcomma }}</td>
			<td>{{ purchaseitem.quantity_queued|intcomma }}</td>
		</tr>{% endfor %}{% else %}
		<tr>
			<td colspan="5">(Empty)</td>
		</tr>{% endif %}
		</tbody>
	</table>
	<br /><br />{% if request_list %}
	<table class="summary hide_queued hide_grouped" id="summary_each">
		<caption>
			Summary for each user{%if agq %}<br />(A: accepted, G: grouped, Q: queued){% endif %}
			<br />Show/hide columns:
			<input type="button" onclick="toggle(2)" value="G" />
			<input type="button" onclick="toggle(3)" value="Q" />
		</caption>
		<colgroup>
			<col class="name" />{% if capsule_list %}{% for capsule in capsule_list %}
			<col class="quantity accepted" />
			<col class="quantity grouped" />
			<col class="quantity queued" />{% endfor %}{% endif %}
			<col class="sum accepted" />
			<col class="sum grouped" />
			<col class="sum queued" />
			<col class="price accepted" />
			<col class="price grouped" />
			<col class="price queued" />
		</colgroup>
		{# BEGIN thead #}{% if capsule_list %}
		<thead>
		<tr>
			<th{% if agq %} class="name" rowspan="2"{% endif %}>User</th>{% for capsule in capsule_list %}
			<th{% if agq %} class="mycolgroup" colspan="1"{% endif %}>{{ capsule.1 }}</th>{% endfor %}
			<th{% if agq %} class="mycolgroup" colspan="1"{% endif %}>Sum</th>
			<th{% if agq %} class="mycolgroup" colspan="1"{% endif %}>Price</th>
		</tr>{% endif %}{% if agq %}
		<tr>{% for capsule in capsule_list %}
			<th class="quantity accepted">A</th>
			<th class="quantity grouped">G</th>
			<th class="quantity queued">Q</th>{% endfor %}
			<th class="sum accepted">A</th>
			<th class="sum grouped">G</th>
			<th class="sum queued">Q</th>
			<th class="price accepted">A</th>
			<th class="price grouped">G</th>
			<th class="price queued">Q</th>
		</tr>
		</thead>{% endif %}{# END thead #}
		{# BEGIN tfoot #}{% if total_row %}
		<tfoot>
		<tr>{% for i in total_row %}
			{% if forloop.first %}<td class="name">{{ i }}</td>{% else %}<td class="{% cycle "accepted" "grouped" "queued" %}">{{ i|intcomma }}</td>{% endif %}{% endfor %}
		</tr>
		</tfoot>{% endif %}{# END tfoot #}
		{# BEGIN body #}{% if request_list %}
		<tbody>	{% for request in request_list %}
		<tr>{% for i in request %}
			{% if forloop.first %}<td class="name">{{ i }}</td>{% else %}<td class="{% cycle "accepted" "grouped" "queued" %}">{{ i|intcomma }}</td>{% endif %}{% endfor %}
		</tr>{% endfor %}
		</tbody>{% endif %}{# END tbody #}
	</table>{% endif %}
	<div style="text-align: center">
		<br /><a href="{% url 'coffee_capsules:request' purchase.pk %}">Order</a>
	</div>
	<div class="footer">
		<a href="{% url 'coffee_capsules:index' %}">back to list</a>
	</div>
{% endblock %}
